# Mini blog con FastAPI

Proyecto de ejemplo con **FastAPI**, **SQLAlchemy** y soporte para **SQLite** (por defecto) o **PostgreSQL** (opcional).

## Requisitos
- Python 3.10+
- pip
- (Opcional) Docker y Docker Compose para PostgreSQL

## Configuración del entorno
Desde la carpeta del proyecto:

```bash
python3 -m venv .venv
source .venv/bin/activate  # macOS / Linux
```

Instalar dependencias:
```bash
pip install -r requirements.txt
```

## Variables de entorno
Crea un archivo `.env` en la raíz con la cadena de conexión `DATABASE_URL`.

Ejemplos:
- SQLite (por defecto si no se define):
  ```env
  DATABASE_URL=sqlite:///./blog.db
  ```
- PostgreSQL (psycopg v3):
  ```env
  DATABASE_URL=postgresql+psycopg://dev:devpassword@localhost:5432/blogdb
  ```

## (Opcional) PostgreSQL con Docker Compose
Ejecuta una base de datos local de Postgres:

```yaml
# docker-compose.yml
version: "3.9"
services:
  db:
    image: postgres:16-alpine
    environment:
      - POSTGRES_USER=dev
      - POSTGRES_PASSWORD=devpassword
      - POSTGRES_DB=blogdb
    ports:
      - "5432:5432"
    volumes:
      - db_data:/var/lib/postgresql/data
volumes:
  db_data:
```

Levantar el servicio:
```bash
docker compose up -d
```

## Ejecutar la aplicación
Con el entorno activo:
```bash
uvicorn main:app --reload
```

Documentación:
- Swagger UI: http://127.0.0.1:8000/docs
- ReDoc: http://127.0.0.1:8000/redoc

## Endpoints principales
- `GET /`  
  Salud de la API.

- `GET /posts` (response_model: `PaginatedPost`)  
  Parámetros:
  - `search` (alias de `query`, opcional, min 3): filtro por título (ILIKE)
  - `per_page` (1-50, por defecto 10)
  - `page` (>=1, por defecto 1)
  - `order_by` ("id" | "title")
  - `direction` ("asc" | "desc")

- `GET /posts/by-tags` (response_model: `List[PostPublic]`)  
  Parámetros:
  - `tags`: múltiples valores, ej: `?tags=python&tags=fastapi`

- `GET /posts/{post_id}` (response_model: `PostPublic | PostSummary`)  
  Parámetros:
  - `include_content` (bool, por defecto `true`) para alternar entre detalles y resumen.

- `POST /posts` (201, response_model: `PostPublic`)  
  Crea un post con `title`, `content`, `tags[]` y `author` (si no existe el autor/tags, se crean).

- `PUT /posts/{post_id}` (response_model: `PostPublic`)  
  Actualiza campos parciales (`title`, `content`).

- `DELETE /posts/{post_id}` (204)  
  Elimina un post. 204 no retorna contenido.

## Notas
- Pydantic v2: conversión de ORM con `model_validate(..., from_attributes=True)`.
- SQLAlchemy 2.x (estilo select/ORM). Asegúrate de definir `DATABASE_URL` correcto para tu entorno.
